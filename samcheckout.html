<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sam's Shop - Self Checkout</title>
    <style>
        /* --- VISUAL SETUP --- */
        body { margin: 0; font-family: 'Arial', sans-serif; background-color: white; overflow: hidden; user-select: none; }
        
        /* The Header (Green Bar) */
        .header { background-color: #4CAF50; color: white; padding: 15px; text-align: center; font-size: 28px; font-weight: bold; border-bottom: 5px solid #388E3C; }
        .sub-header { font-size: 16px; font-weight: normal; margin-top: 5px; opacity: 0.9; }

        /* Screen States */
        .screen { display: none; height: 100vh; flex-direction: column; }
        .active { display: flex; }

        /* --- SCREEN 1: WELCOME --- */
        #screen-welcome { align-items: center; justify-content: center; text-align: center; cursor: pointer; }
        .welcome-content { margin-top: -100px; }
        .tap-icon { font-size: 100px; margin-bottom: 20px; animation: bounce 2s infinite; }
        h1 { font-size: 40px; color: #333; margin: 10px 0; }
        .card-only { color: #d32f2f; font-weight: bold; font-size: 24px; border: 3px solid #d32f2f; padding: 10px 30px; border-radius: 8px; display: inline-block; margin-top: 20px; }

        /* --- SCREEN 2: SCANNING --- */
        #screen-scanning { justify-content: space-between; }
        .cart-area { flex-grow: 1; overflow-y: auto; padding: 20px; }
        .cart-item { display: flex; justify-content: space-between; padding: 15px 0; border-bottom: 1px solid #eee; font-size: 20px; }
        .item-name { font-weight: bold; color: #333; }
        .item-sub { font-size: 14px; color: #777; margin-top: 4px; }
        .item-price { font-weight: bold; }

        .footer { background: #333; color: white; padding: 20px; box-shadow: 0 -4px 10px rgba(0,0,0,0.2); }
        .total-row { display: flex; justify-content: space-between; font-size: 32px; font-weight: bold; margin-bottom: 20px; }
        
        .action-row { display: flex; gap: 10px; }
        .btn { flex: 1; padding: 20px; border: none; border-radius: 8px; font-size: 24px; font-weight: bold; cursor: pointer; }
        .btn-assist { background: #ff9800; color: white; flex: 0.4; }
        .btn-pay { background: #4CAF50; color: white; }
        
        /* --- SCREEN 3: FAKE KEYPAD --- */
        .overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); display: none; justify-content: center; align-items: center; z-index: 100; }
        .pin-pad { background: #eee; padding: 30px; border-radius: 15px; width: 340px; text-align: center; box-shadow: 0 10px 25px rgba(0,0,0,0.5); }
        .pin-screen { background: white; border: 2px solid #ccc; padding: 20px; font-size: 24px; margin-bottom: 20px; border-radius: 5px; min-height: 30px; }
        .keys { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; }
        .key { background: white; padding: 20px; font-size: 24px; border-radius: 8px; cursor: pointer; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .key:active { background: #ddd; transform: translateY(2px); }
        .key-cancel { background: #e53935; color: white; }
        .key-enter { background: #43a047; color: white; }

        /* --- SCREEN 4: SUCCESS --- */
        #screen-success { align-items: center; justify-content: center; text-align: center; background: #e8f5e9; }
        .success-msg { font-size: 40px; color: #2e7d32; font-weight: bold; margin-top: 20px; }

        /* Utilities */
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-15px); } }
        #ghost-input { position: absolute; opacity: 0; top: -1000px; }
    </style>
</head>
<body>

    <div id="screen-welcome" class="screen active" onclick="startSession()">
        <div class="header" style="width: 100%; position: absolute; top:0;">
            Off you POP To Sam's Shop
            <div class="sub-header">Co. Dublin Howth</div>
        </div>
        <div class="welcome-content">
            <div class="tap-icon">ðŸ‘†</div>
            <h1>Tap Here Or Scan</h1>
            <p style="font-size: 20px; color: #666;">Your first item to Start</p>
            <div class="card-only">CARD ONLY</div>
        </div>
    </div>

    <div id="screen-scanning" class="screen">
        <div class="header">
            Sam's Shop
            <div class="sub-header">Scanning...</div>
        </div>

        <div class="cart-area" id="cart-list">
            <div style="text-align: center; color: #aaa; margin-top: 100px; font-size: 24px;">
                Scan an item to begin...
            </div>
        </div>

        <div class="footer">
            <div class="total-row">
                <span>TOTAL</span>
                <span id="total-display">â‚¬0.00</span>
            </div>
            <div class="action-row">
                <button class="btn btn-assist" onclick="alert('Staff has been notified!')">Help</button>
                <button class="btn btn-pay" onclick="showPayment()">Pay Now</button>
            </div>
        </div>
        
        <input type="text" id="ghost-input" autocomplete="off">
    </div>

    <div id="payment-overlay" class="overlay">
        <div class="pin-pad">
            <div class="pin-screen" id="pin-msg">Please Enter PIN</div>
            <div class="keys">
                <div class="key">1</div><div class="key">2</div><div class="key">3</div>
                <div class="key">4</div><div class="key">5</div><div class="key">6</div>
                <div class="key">7</div><div class="key">8</div><div class="key">9</div>
                <div class="key key-cancel" onclick="cancelPay()">X</div>
                <div class="key">0</div>
                <div class="key key-enter" onclick="confirmPay()">O</div>
            </div>
        </div>
    </div>

    <div id="screen-success" class="screen">
        <div style="font-size: 100px;">âœ…</div>
        <div class="success-msg">Thanks for shopping<br>at Sam's Shop</div>
        <p style="font-size: 20px; color: #555; margin-top: 20px;">Please take your receipt</p>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, child, get } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        // Your Firebase Config
        const firebaseConfig = {
            apiKey: "AIzaSyAXtjM56OQso8g3RauOkT3h1ommplCelyE",
            authDomain: "checkout-c52ab.firebaseapp.com",
            projectId: "checkout-c52ab",
            databaseURL: "https://checkout-c52ab-default-rtdb.europe-west1.firebasedatabase.app",
            storageBucket: "checkout-c52ab.firebasestorage.app",
            messagingSenderId: "486554411560",
            appId: "1:486554411560:web:9d24b172a86cfe1b2c0b1d"
        };

        const app = initializeApp(firebaseConfig);
        const dbRef = ref(getDatabase(app));

        // Variables
        let cart = [];
        let total = 0.00;

        // Functions exposed to HTML
        window.startSession = function() {
            switchScreen('screen-scanning');
            focusScanner();
        };

        window.showPayment = function() {
            if (cart.length === 0) return;
            document.getElementById('payment-overlay').style.display = 'flex';
        };

        window.cancelPay = function() {
            document.getElementById('payment-overlay').style.display = 'none';
            focusScanner();
        };

        window.confirmPay = function() {
            const msg = document.getElementById('pin-msg');
            msg.innerText = "Processing...";
            msg.style.color = "green";
            
            setTimeout(() => {
                document.getElementById('payment-overlay').style.display = 'none';
                switchScreen('screen-success');
                // Reset after 5 seconds
                setTimeout(() => location.reload(), 5000);
            }, 2000);
        };

        function switchScreen(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }

        // --- SCANNING SYSTEM ---
        function focusScanner() {
            const input = document.getElementById('ghost-input');
            input.focus();
            // Ensure focus stays for scanner
            document.body.onclick = () => input.focus();
        }

        // Listen for scanner input
        document.getElementById('ghost-input').addEventListener('keydown', function(e) {
            if (e.key === 'Enter') {
                const code = this.value;
                this.value = '';
                if(code.length > 0) lookupItem(code);
            }
        });

        function lookupItem(barcode) {
            get(child(dbRef, `inventory/${barcode}`)).then((snapshot) => {
                if (snapshot.exists()) {
                    addToCart(snapshot.val());
                } else {
                    alert("Unknown Item: " + barcode);
                }
            }).catch((error) => {
                console.error(error);
            });
        }

        function addToCart(item) {
            // Clear "Scan an item..." text if first item
            if (cart.length === 0) document.getElementById('cart-list').innerHTML = '';

            cart.push(item);
            total += item.item_price;
            if(item.is_deposit) total += 0.15; // DRS Deposit Logic

            const depositHtml = item.is_deposit ? '<div class="item-sub">+ â‚¬0.15 Deposit</div>' : '';
            
            const html = `
                <div class="cart-item">
                    <div>
                        <div class="item-name">${item.item_name}</div>
                        ${depositHtml}
                    </div>
                    <div class="item-price">â‚¬${item.item_price.toFixed(2)}</div>
                </div>`;
            
            document.getElementById('cart-list').innerHTML += html;
            document.getElementById('total-display').innerText = "â‚¬" + total.toFixed(2);
            
            // Auto scroll to bottom
            const area = document.getElementById('cart-list');
            area.scrollTop = area.scrollHeight;
        }
    </script>
</body>
</html>
