<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Sam's Shop - Display</title>
    <style>
        /* --- GLOBAL STYLES --- */
        body { margin: 0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; overflow: hidden; background: #e0e0e0; user-select: none; }
        .screen { display: none; height: 100vh; flex-direction: column; background: #f4f4f4; }
        .active { display: flex; }
        
        /* --- HEADER SECTION --- */
        .top-banner { background-color: #008f36; color: white; padding: 10px; text-align: center; font-weight: bold; font-size: 20px; letter-spacing: 1px; }
        .header-main { background-color: white; border-bottom: 4px solid #008f36; padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .brand-text { display: flex; flex-direction: column; }
        .shop-name { font-size: 28px; font-weight: 900; color: #333; margin: 0; }
        .shop-loc { font-size: 14px; color: #666; margin-top: 2px; }
        
        .btn-assist { background: #007bff; color: white; border: none; padding: 12px 25px; font-size: 18px; font-weight: bold; border-radius: 6px; cursor: pointer; box-shadow: 0 2px 4px rgba(0,0,0,0.2); }
        .btn-assist:active { transform: translateY(2px); }

        /* --- WELCOME SCREEN (Page 1) --- */
        #view-welcome { background: white; }
        .welcome-body { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; }
        
        .tap-circle { width: 220px; height: 220px; background: #008f36; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 80px; box-shadow: 0 10px 20px rgba(0,143,54,0.3); margin-bottom: 30px; animation: pulse 2s infinite; cursor: pointer; }
        
        .instruction-text { font-size: 32px; font-weight: bold; color: #333; max-width: 60%; line-height: 1.4; }
        .small-text { font-size: 22px; font-weight: normal; color: #555; display: block; margin-top: 10px; }
        
        .card-only-badge { margin-top: 40px; border: 3px solid #d32f2f; color: #d32f2f; padding: 10px 40px; font-size: 24px; font-weight: 800; text-transform: uppercase; border-radius: 8px; background: #fff0f0; }

        /* --- SCANNING SCREEN (Page 2) --- */
        #view-scanning { background: #f4f4f4; }
        .cart-container { flex: 1; padding: 20px 40px; overflow-y: auto; }
        
        /* Receipt Style Item List */
        .cart-item { background: white; padding: 20px; margin-bottom: 15px; border-radius: 8px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 5px rgba(0,0,0,0.05); border-left: 6px solid #008f36; }
        .item-info { font-size: 24px; font-weight: 600; color: #333; }
        .item-meta { font-size: 16px; color: #777; margin-top: 5px; font-weight: normal; }
        .item-price { font-size: 26px; font-weight: bold; color: #333; }

        /* Footer / Total Area */
        .footer-bar { background: white; padding: 20px 40px; border-top: 1px solid #ccc; box-shadow: 0 -5px 15px rgba(0,0,0,0.05); }
        .total-display { display: flex; justify-content: space-between; align-items: center; font-size: 36px; font-weight: 800; color: #333; margin-bottom: 20px; }
        
        .action-buttons { display: flex; gap: 20px; height: 80px; }
        .btn-big { flex: 1; border: none; border-radius: 8px; font-size: 28px; font-weight: bold; cursor: pointer; color: white; display: flex; align-items: center; justify-content: center; transition: background 0.2s; }
        .btn-pay { background-color: #008f36; box-shadow: 0 4px 0 #006426; }
        .btn-pay:active { box-shadow: none; transform: translateY(4px); }
        .btn-help { background-color: #ff9800; flex: 0.3; box-shadow: 0 4px 0 #e68900; }

        /* --- PAYMENT OVERLAY (Page 3 Style) --- */
        #overlay-paying { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 100; display: none; flex-direction: column; align-items: center; justify-content: center; color: white; }
        .pay-card-box { background: white; color: #333; padding: 40px; border-radius: 15px; text-align: center; max-width: 500px; width: 90%; }
        .pay-summary { font-size: 24px; margin-bottom: 20px; border-bottom: 1px solid #eee; padding-bottom: 15px; }
        .pay-total-large { font-size: 50px; font-weight: 900; color: #008f36; margin: 10px 0; }
        .pay-instr { font-size: 22px; color: #555; margin-bottom: 30px; }
        
        /* --- SUCCESS SCREEN --- */
        #view-success { align-items: center; justify-content: center; text-align: center; background: #e8f5e9; }
        .success-box { background: white; padding: 50px 80px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        .check-icon { font-size: 100px; color: #008f36; margin-bottom: 20px; display: block; }
        .thx-text { font-size: 36px; font-weight: bold; color: #333; }

        /* --- ANIMATIONS --- */
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(0, 143, 54, 0.7); } 70% { box-shadow: 0 0 0 20px rgba(0, 143, 54, 0); } 100% { box-shadow: 0 0 0 0 rgba(0, 143, 54, 0); } }
    </style>
</head>
<body>

    <div id="view-welcome" class="screen active" onclick="startShop()">
        <div class="top-banner">Off you POP To Sam's Shop</div>
        
        <div class="header-main">
            <div class="brand-text">
                <h1 class="shop-name">Sam's Shop</h1>
                <span class="shop-loc">Co. Dublin Howth</span>
            </div>
            <button class="btn-assist" onclick="event.stopPropagation(); callAssistance()">Assistance</button>
        </div>

        <div class="welcome-body">
            <div class="tap-circle">
                ðŸ‘†
            </div>
            <div class="instruction-text">
                Tap Here Or Scan
                <span class="small-text">Your first item to Start</span>
            </div>
            <div class="card-only-badge">Card Only</div>
        </div>
    </div>

    <div id="view-scanning" class="screen">
        <div class="top-banner">Sam's Shop Self Checkout</div>
        
        <div class="header-main">
            <div class="brand-text">
                <h1 class="shop-name">Sam's Shop</h1>
                <span class="shop-loc">Co. Dublin Howth</span>
            </div>
            <button class="btn-assist" onclick="callAssistance()">Assistance</button>
        </div>

        <div class="cart-container" id="cart-container">
            <div style="text-align: center; color: #999; margin-top: 80px; font-size: 24px;">
                Ready to scan...
            </div>
        </div>

        <div id="overlay-paying">
            <div class="pay-card-box">
                <div class="pay-summary" id="pay-item-count">0 items</div>
                <div style="font-size: 20px;">TOTAL TO PAY</div>
                <div class="pay-total-large" id="pay-total-overlay">â‚¬0.00</div>
                <div class="pay-instr">Please use the card terminal<br>to complete payment</div>
                <button onclick="cancelPay()" style="background:none; border:none; text-decoration:underline; color:#d32f2f; font-size:18px; cursor:pointer;">Cancel Payment</button>
            </div>
        </div>

        <div class="footer-bar">
            <div class="total-display">
                <span>TOTAL</span>
                <span id="total-price">â‚¬0.00</span>
            </div>
            <div class="action-buttons">
                <button class="btn-big btn-help" onclick="callAssistance()">Help</button>
                <button class="btn-big btn-pay" onclick="initiatePay()">Pay by card</button>
            </div>
        </div>
    </div>

    <div id="view-success" class="screen">
        <div class="success-box">
            <span class="check-icon">âœ…</span>
            <div class="thx-text">Thanks for shoping<br>at Sam's Shop</div>
            <p style="margin-top:20px; color:#666; font-size: 18px;">Please take your receipt</p>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAXtjM56OQso8g3RauOkT3h1ommplCelyE",
            authDomain: "checkout-c52ab.firebaseapp.com",
            projectId: "checkout-c52ab",
            databaseURL: "https://checkout-c52ab-default-rtdb.europe-west1.firebasedatabase.app",
            storageBucket: "checkout-c52ab.firebasestorage.app",
            messagingSenderId: "486554411560",
            appId: "1:486554411560:web:9d24b172a86cfe1b2c0b1d"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // --- BUTTON ACTIONS ---
        window.startShop = function() {
            set(ref(db, 'session/status'), 'scanning');
        };

        window.initiatePay = function() {
            set(ref(db, 'session/status'), 'paying');
        };

        window.cancelPay = function() {
            set(ref(db, 'session/status'), 'scanning');
        };

        window.callAssistance = function() {
            alert("âš ï¸ STAFF CALLED to Register 1");
        };

        // --- FIREBASE LISTENER ---
        onValue(ref(db, 'session'), (snapshot) => {
            const data = snapshot.val();
            if (!data) return;

            // Reset screens
            document.querySelectorAll('.screen').forEach(el => el.classList.remove('active'));
            const overlay = document.getElementById('overlay-paying');

            // 1. WELCOME
            if (data.status === 'welcome') {
                document.getElementById('view-welcome').classList.add('active');
                overlay.style.display = 'none';
            } 
            // 2. SCANNING
            else if (data.status === 'scanning') {
                document.getElementById('view-scanning').classList.add('active');
                overlay.style.display = 'none';
                renderCart(data.cart);
            }
            // 3. PAYING (Overlay)
            else if (data.status === 'paying') {
                document.getElementById('view-scanning').classList.add('active');
                overlay.style.display = 'flex'; // Show the "Pay by card" box
                renderCart(data.cart);
            }
            // 4. SUCCESS
            else if (data.status === 'success') {
                document.getElementById('view-success').classList.add('active');
                overlay.style.display = 'none';
                
                // Auto Reset after 5s
                setTimeout(() => {
                    set(ref(db, 'session'), { status: 'welcome', cart: {} });
                }, 5000);
            }
        });

        function renderCart(cartData) {
            const container = document.getElementById('cart-container');
            const totalDisplay = document.getElementById('total-price');
            const overlayTotal = document.getElementById('pay-total-overlay');
            const overlayCount = document.getElementById('pay-item-count');

            if (!cartData) {
                container.innerHTML = '<div style="text-align: center; color: #999; margin-top: 80px; font-size: 24px;">Ready to scan...</div>';
                totalDisplay.innerText = "â‚¬0.00";
                return;
            }

            container.innerHTML = '';
            let total = 0;
            let count = 0;

            Object.values(cartData).forEach(item => {
                total += item.price;
                count++;
                
                // Dynamic deposit text logic
                const depositHtml = item.is_deposit ? '<div class="item-meta">+ deposit included</div>' : '';
                
                container.innerHTML += `
                    <div class="cart-item">
                        <div>
                            <div class="item-info">${item.name}</div>
                            ${depositHtml}
                        </div>
                        <div class="item-price">â‚¬${item.price.toFixed(2)}</div>
                    </div>`;
            });

            const finalPrice = "â‚¬" + total.toFixed(2);
            totalDisplay.innerText = finalPrice;
            overlayTotal.innerText = finalPrice;
            overlayCount.innerText = count + " items";
            
            // Auto scroll to bottom of list
            container.scrollTop = container.scrollHeight;
        }
    </script>
</body>
</html>
