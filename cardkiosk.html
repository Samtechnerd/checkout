<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Tesco Kiosk iPad</title>
    <style>
        :root { --blue: #00539f; --grey: #f3f3f3; --green: #008137; }
        body { margin: 0; font-family: Arial, sans-serif; background: white; overflow: hidden; -webkit-user-select: none; }
        
        .screen { display: none; width: 100vw; height: 100vh; }
        .active { display: block; }
        
        /* Start Screen Styling */
        #start { 
            background: url('https://www.tesco.com/groceries/en-GB/resources/images/background-peas.jpg'); 
            background-size: cover; 
            display: flex; justify-content: center; align-items: center; 
        }
        .overlay { background: white; width: 85%; padding: 40px; border-radius: 10px; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
        .card-only-text { font-size: 4rem; margin: 0 0 20px 0; font-weight: bold; }
        
        /* Basket View Styling */
        .header { background: var(--blue); color: white; padding: 15px 25px; display: flex; justify-content: space-between; align-items: center; }
        .logo-btn { background: none; border: none; color: white; font-weight: bold; font-size: 1.8rem; cursor: pointer; }
        .container { display: flex; height: calc(100vh - 70px); }
        .items-area { flex: 2; padding: 20px; overflow-y: auto; background: white; }
        .sidebar { flex: 1; background: var(--grey); padding: 25px; display: flex; flex-direction: column; border-left: 1px solid #ddd; }
        
        .item-row { display: flex; justify-content: space-between; padding: 20px; border-bottom: 1px solid #eee; font-size: 1.4rem; animation: slideIn 0.3s ease-out; }
        .total-card { background: white; padding: 25px; border-radius: 12px; text-align: center; margin-top: auto; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
        .pay-btn { background: var(--green); color: white; font-size: 2.2rem; padding: 20px; border: none; border-radius: 50px; width: 100%; margin-top: 15px; font-weight: bold; }
        
        @keyframes slideIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <div id="start" class="screen active">
        <div class="overlay">
            <h1 class="card-only-text">Card Only</h1>
            <div style="display:flex; justify-content: space-around; align-items: center; margin-top: 40px;">
                <div style="flex:1">
                    <img src="https://img.icons8.com/ios-filled/100/00539f/shopping-basket-2.png"><br>
                    <h2 style="margin:10px 0">Self service</h2>
                    <p style="color:#666">Please Scan Your first item [cite: 6]<br>or tap Here to Start [cite: 7]</p>
                </div>
                <div style="border-left: 1px dashed #ccc; height: 180px;"></div>
                <div style="flex:1">
                    <img src="https://img.icons8.com/ios/100/000000/barcode.png"><br>
                    <h2 style="margin:10px 0">Scan as you Shop</h2>
                    <p style="color:#666">Please Scan this Barcode [cite: 10]<br>to start</p>
                </div>
            </div>
        </div>
    </div>

    <div id="basket" class="screen">
        <div class="header">
            <button class="logo-btn" id="resetBtn">TESCO</button>
            <button style="background:white; color:var(--blue); border:none; padding:8px 20px; border-radius:20px; font-weight:bold">Assistance [cite: 8]</button>
        </div>
        <div class="container">
            <div class="items-area" id="itemList">
                </div>
            <div class="sidebar">
                <button style="padding:15px; margin-bottom:10px; border:1px solid #ccc; background:white; border-radius:5px">Find item [cite: 18]</button>
                <button style="padding:15px; margin-bottom:10px; border:1px solid #ccc; background:white; border-radius:5px">Own Bag [cite: 19]</button>
                
                <div class="total-card">
                    <p style="margin:0; color:#666; font-weight:bold">TOTAL [cite: 20]</p>
                    <h1 id="totalPrice" style="font-size:3.5rem; margin:10px 0">€0.00</h1>
                    <button class="pay-btn">Pay [cite: 22]</button>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, onValue, set } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        // Your specific regional config
        const firebaseConfig = {
            apiKey: "AIzaSyAXtjM56OQso8g3RauOkT3h1ommplCelyE",
            authDomain: "checkout-c52ab.firebaseapp.com",
            projectId: "checkout-c52ab",
            databaseURL: "https://checkout-c52ab-default-rtdb.europe-west1.firebasedatabase.app",
            storageBucket: "checkout-c52ab.firebasestorage.app",
            messagingSenderId: "486554411560",
            appId: "1:486554411560:web:9d24b172a86cfe1b2c0b1d"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const basketPath = 'terminals/111/basket';

        // 1. Listen for Live Data
        onValue(ref(db, basketPath), (snap) => {
            const data = snap.val();
            if(!data) {
                // If basket is empty, show Start Screen
                document.getElementById('basket').classList.remove('active');
                document.getElementById('start').classList.add('active');
                return;
            }

            // Otherwise, show Basket Screen
            document.getElementById('start').classList.remove('active');
            document.getElementById('basket').classList.add('active');

            let total = 0;
            let html = '';
            Object.values(data).forEach(item => {
                html += `
                    <div class="item-row">
                        <span>${item.name} [cite: 14]</span>
                        <span style="font-weight:bold">€${item.price.toFixed(2)} [cite: 16]</span>
                    </div>`;
                total += item.price;
            });
            document.getElementById('itemList').innerHTML = html;
            document.getElementById('totalPrice').innerText = '€' + total.toFixed(2);
        });

        // 2. Hidden Reset Feature (Click 'TESCO' to clear basket)
        document.getElementById('resetBtn').addEventListener('click', () => {
            if(confirm("Reset Kiosk for next customer?")) {
                set(ref(db, basketPath), null);
            }
        });
    </script>
</body>
</html>
