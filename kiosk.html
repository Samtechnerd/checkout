<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Functional Sam's Checkout | iPad Optimized</title>
    <script src="https://unpkg.com/html5-qrcode"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    
    <style>
        :root { --blue: #00539f; --red: #ee1c2e; --grey: #f3f3f3; --orange: #ff8a00; }
        body { font-family: Arial, sans-serif; margin: 0; background: var(--grey); overflow: hidden; height: 100vh; width: 100vw; }

        /* Branding */
        .header-logo { padding: 25px 0 0 45px; position: absolute; top: 0; left: 0; z-index: 10; }
        .logo-img { width: 150px; }

        /* Screen Management */
        .screen { display: none; height: 100vh; width: 100vw; flex-direction: column; align-items: center; }
        .active { display: flex; }

        /* Welcome Screen */
        #screen-welcome { justify-content: center; }
        .hello-container { 
            background: white; width: 85%; max-width: 1100px; height: 45vh; 
            border: 1px solid #ddd; display: flex; align-items: center; 
            justify-content: center; margin-bottom: 40px; box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        }
        .hello { font-size: 130px; font-weight: bold; color: var(--blue); letter-spacing: -3px; }
        .hello span { color: var(--red); }

        .btn-row { display: flex; gap: 20px; margin-bottom: 25px; }
        .btn-main { padding: 22px 60px; font-size: 28px; font-weight: bold; border-radius: 60px; cursor: pointer; border: 3px solid var(--blue); min-width: 280px; text-align: center; }
        .btn-blue { background: var(--blue); color: white; }
        .btn-outline { background: white; color: var(--blue); }

        /* Scanning Screen */
        #screen-scan { flex-direction: row; align-items: stretch; background: white; }
        .left-side { flex: 2; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px; }
        #reader { width: 95%; max-width: 600px; aspect-ratio: 4/3; border-radius: 12px; background: black; overflow: hidden; }
        
        .right-side { flex: 1; border-left: 2px solid #eee; display: flex; flex-direction: column; min-width: 380px; }
        .utility-header { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; padding: 15px; border-bottom: 1px solid #eee; }
        .btn-util { padding: 12px; font-size: 16px; border: 2px solid var(--blue); color: var(--blue); background: white; border-radius: 30px; font-weight: bold; cursor: pointer; }

        .basket { flex-grow: 1; overflow-y: auto; padding: 20px; }
        .item-row { display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid #f0f0f0; font-size: 20px; }
        .total-box { padding: 30px; border-top: 2px solid #ddd; background: white; }
        .total-val { font-size: 50px; font-weight: bold; text-align: right; margin-bottom: 20px; }

        /* Payment Screen */
        #screen-pay { justify-content: center; padding: 60px; background: var(--grey); }
        .pay-grid { display: flex; gap: 30px; width: 80%; max-width: 1000px; justify-content: center; margin-top: 40px; }
        .pay-box { 
            background: white; border: 4px solid var(--blue); border-radius: 20px;
            flex: 1; height: 350px; display: flex; align-items: center; 
            justify-content: center; font-size: 60px; font-weight: bold; 
            color: var(--blue); cursor: pointer; transition: 0.2s;
        }

        /* Footer */
        .footer { position: fixed; bottom: 30px; left: 45px; display: flex; gap: 40px; }
        .footer-item { text-align: center; color: var(--blue); font-size: 14px; font-weight: bold; cursor: pointer; display: flex; flex-direction: column; align-items: center; }
        .circle { width: 55px; height: 55px; border: 2px solid var(--blue); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 28px; margin-bottom: 8px; }
    </style>
</head>
<body>

    <div class="header-logo"><img src="https://upload.wikimedia.org/wikipedia/en/thumb/b/b0/Tesco_Logo.svg/1200px-Tesco_Logo.svg.png" class="logo-img"></div>

    <div id="screen-welcome" class="screen active">
        <div class="hello-container"><div class="hello">Hello<span>.</span></div></div>
        <div class="btn-row">
            <button class="btn-main btn-blue" onclick="changeScreen('screen-scan')">Start Scanning</button>
            <button class="btn-main btn-outline" onclick="changeScreen('screen-scan')">Shop and Scan</button>
        </div>
        <p style="color:#555; font-size: 18px; text-align: center;">For <b>Shop and Scan</b> please press the<br>Shop and Scan button above.</p>
        <button class="btn-main btn-outline" style="padding: 10px 40px; font-size: 18px; min-width: 200px; margin-top: 15px;">Sams checkout</button>
    </div>

    <div id="screen-scan" class="screen">
        <div class="left-side">
            <div id="reader"></div>
            <p style="color: var(--blue); font-weight: bold; margin-top: 20px;">Position barcode in the center of the box</p>
        </div>
        <div class="right-side">
            <div class="utility-header">
                <button class="btn-util">Find item</button>
                <button class="btn-util">Voucher</button>
            </div>
            <div style="padding: 15px; font-size: 22px; font-weight: bold; border-bottom: 1px solid #eee;">üõí Items: <span id="count">0</span></div>
            <div class="basket" id="basket"></div>
            <div class="total-box">
                <div class="total-val">‚Ç¨<span id="total-val-num">0.00</span></div>
                <button class="btn-main btn-blue" style="width: 100%; font-size: 32px;" onclick="changeScreen('screen-pay')">Pay Now</button>
            </div>
        </div>
    </div>

    <div id="screen-pay" class="screen">
        <h1 style="color: var(--blue); font-size: 60px; margin: 0;">Select payment type</h1>
        <div class="pay-grid">
            <div class="pay-box" onclick="finish()">Cash</div>
            <div class="pay-box" onclick="finish()">Card</div>
        </div>
        <button class="btn-main btn-outline" style="margin-top: 50px; padding: 15px 50px;" onclick="changeScreen('screen-scan')">Return</button>
    </div>

    <div class="footer">
        <div class="footer-item"><div class="circle">?</div>Assistance</div>
        <div class="footer-item"><div class="circle">üîä</div>Volume</div>
        <div class="footer-item"><div class="circle">üõçÔ∏è</div>Own bag</div>
    </div>

    <script>
        const firebaseConfig = { 
            apiKey: "AIzaSyAXtjM56OQso8g3RauOkT3h1ommplCelyE", 
            authDomain: "checkout-c52ab.firebaseapp.com", 
            projectId: "checkout-c52ab", 
            storageBucket: "checkout-c52ab.firebasestorage.app", 
            messagingSenderId: "486554411560", 
            appId: "1:486554411560:web:9d24b172a86cfe1b2c0b1d" 
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        let basket = [];
        let scanner = null;
        const beep = new Audio('BEEP.mp3');

        function changeScreen(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            if(id === 'screen-scan' && !scanner) {
                scanner = new Html5Qrcode("reader");
                
                // iPad Optimized Scanner Settings
                const config = { 
                    fps: 20, 
                    qrbox: { width: 450, height: 200 }, // Wider box for 1D barcodes
                    aspectRatio: 1.0,
                    videoConstraints: {
                        facingMode: "environment",
                        width: { ideal: 1280 }, // Higher resolution for better detail
                        height: { ideal: 720 }
                    }
                };
                
                scanner.start({ facingMode: "environment" }, config, onScan);
            }
        }

        async function onScan(code) {
            const doc = await db.collection("inventory").doc(code).get();
            if (doc.exists) {
                beep.play();
                basket.push(doc.data());
                updateUI();
            }
        }

        function updateUI() {
            let total = 0;
            document.getElementById('basket').innerHTML = basket.map(i => {
                total += i.price;
                return `<div class="item-row"><span>${i.name}</span><strong>‚Ç¨${i.price.toFixed(2)}</strong></div>`;
            }).join('');
            document.getElementById('total-val-num').innerText = total.toFixed(2);
            document.getElementById('count').innerText = basket.length;
        }

        function finish() { alert("Payment Successful!"); location.reload(); }
    </script>
</body>
</html>
