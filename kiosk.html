<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Ultimate Self-Checkout Kiosk</title>
    <script src="https://unpkg.com/html5-qrcode"></script>
    <style>
        :root { --bg: #121212; --panel: #1e1e1e; --text: #ffffff; --accent: #00ff88; }
        body { font-family: 'Segoe UI', sans-serif; margin: 0; display: flex; height: 100vh; background: var(--bg); color: var(--text); }
        
        /* Left: Scanner Side */
        #scanner-side { width: 45%; border-right: 2px solid #333; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px; }
        #reader { width: 100%; max-width: 500px; border-radius: 15px; overflow: hidden; border: 2px solid var(--accent) !important; }
        
        /* Right: Cart Side */
        #cart-side { width: 55%; padding: 40px; display: flex; flex-direction: column; box-sizing: border-box; background: var(--panel); }
        .item-list { flex-grow: 1; overflow-y: auto; margin: 20px 0; border-top: 1px solid #444; }
        .item { display: flex; justify-content: space-between; padding: 15px 0; border-bottom: 1px solid #333; font-size: 1.3rem; }
        
        /* Pricing & Buttons */
        .total-row { font-size: 2.5rem; font-weight: bold; border-top: 2px solid var(--accent); padding-top: 20px; display: flex; justify-content: space-between; }
        .pay-btn { background: var(--accent); color: black; padding: 20px; border: none; border-radius: 12px; font-size: 1.5rem; font-weight: bold; cursor: pointer; margin-top: 20px; }

        /* Staff Menu */
        #staff-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 1000; flex-direction: column; align-items: center; justify-content: center; }
        .staff-box { background: #333; padding: 40px; border-radius: 20px; text-align: center; border: 2px solid orange; }
        .staff-btn { padding: 15px 30px; margin: 10px; font-size: 1.1rem; cursor: pointer; border-radius: 8px; border: none; }
    </style>
</head>
<body>

    <div id="staff-overlay">
        <div class="staff-box">
            <h1 style="color: orange;">MANAGER OVERRIDE</h1>
            <button class="staff-btn" style="background: orange;" onclick="voidLast()">Void Last Item</button>
            <button class="staff-btn" style="background: #ff4444; color: white;" onclick="resetAll()">Clear All</button>
            <button class="staff-btn" style="background: #777; color: white;" onclick="closeStaff()">Back</button>
        </div>
    </div>

    <div id="scanner-side">
        <h2>SCAN BARCODE</h2>
        <div id="reader"></div>
        <p style="color: #888; margin-top: 20px;">Place barcode inside the square</p>
    </div>

    <div id="cart-side">
        <h1>RECEIPT</h1>
        <div class="item-list" id="cartItems">
            </div>
        <div class="total-row">
            <span>TOTAL</span>
            <span id="totalDisplay">$0.00</span>
        </div>
        <button class="pay-btn" onclick="alert('Payment Complete!')">PAY NOW</button>
    </div>

<script>
    let cart = [];
    const STAFF_CODE = "STAFF99"; // Change this to your staff barcode

    // 1. Initialize Scanner
    const scanner = new Html5QrcodeScanner("reader", { 
        fps: 15, 
        qrbox: { width: 300, height: 200 }, // Shape for 1D Barcodes
        aspectRatio: 1.0 
    });

    scanner.render(onScanSuccess, onScanError);

    function onScanSuccess(decodedText) {
        // A. Handle Staff Card
        if (decodedText === STAFF_CODE) {
            document.getElementById('staff-overlay').style.display = 'flex';
            return;
        }

        // B. Handle Mobile Sync (Transferring from phone)
        if (decodedText.startsWith("SYNC:")) {
            const ids = decodedText.replace("SYNC:", "").split(",");
            const inventory = JSON.parse(localStorage.getItem('inventory')) || [];
            
            ids.forEach(id => {
                const product = inventory.find(p => p.id === id);
                if (product) cart.push(product);
            });
            updateUI();
            return;
        }

        // C. Handle Regular Barcode
        const inventory = JSON.parse(localStorage.getItem('inventory')) || [];
        const product = inventory.find(p => p.id === decodedText);

        if (product) {
            cart.push(product);
            updateUI();
        } else {
            console.log("Unknown code: " + decodedText);
        }
    }

    function onScanError(err) {
        // We ignore errors because the scanner throws them every frame it doesn't find a code
    }

    function updateUI() {
        const list = document.getElementById('cartItems');
        let total = 0;
        list.innerHTML = cart.map(item => {
            total += parseFloat(item.price);
            return `<div class="item"><span>${item.name}</span><span>$${parseFloat(item.price).toFixed(2)}</span></div>`;
        }).join('');
        document.getElementById('totalDisplay').innerText = `$${total.toFixed(2)}`;
    }

    // Staff Functions
    function voidLast() { cart.pop(); updateUI(); closeStaff(); }
    function resetAll() { cart = []; updateUI(); closeStaff(); }
    function closeStaff() { document.getElementById('staff-overlay').style.display = 'none'; }
</script>
</body>
</html>

