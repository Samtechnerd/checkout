<!DOCTYPE html>
<html>
<head>
    <title>Tesco Restocker - Cloud Control</title>
    <script src="https://unpkg.com/html5-qrcode"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <style>
        :root { --blue: #00539f; --light: #f3f3f3; }
        body { font-family: Arial, sans-serif; background: var(--light); padding: 20px; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; max-width: 1000px; margin: auto; }
        .box { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        h2 { color: var(--blue); margin-top: 0; }
        input { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ccc; border-radius: 8px; box-sizing: border-box; font-size: 16px; }
        button { width: 100%; padding: 15px; background: var(--blue); color: white; border: none; border-radius: 30px; font-weight: bold; cursor: pointer; margin-top: 10px; }
        #reader { width: 100%; border-radius: 8px; margin-bottom: 15px; display: none; }
        .scan-toggle { background: #444; margin-bottom: 15px; }
    </style>
</head>
<body>

    <div class="grid">
        <div class="box">
            <h2>ðŸ›’ Product Manager</h2>
            <button class="scan-toggle" onclick="toggleScanner('p')">ðŸ“· Scan Product Barcode</button>
            <div id="reader"></div>
            
            <input type="text" id="pBarcode" placeholder="Barcode ID (Scanned or Typed)">
            <input type="text" id="pName" placeholder="Product Name">
            <input type="number" id="pPrice" placeholder="Price (Â£)" step="0.01">
            <button onclick="saveItem('inventory')">Save to Cloud</button>
        </div>

        <div class="box">
            <h2>ðŸ”‘ Staff Settings</h2>
            <button class="scan-toggle" onclick="toggleScanner('s')">ðŸ“· Scan Staff Card</button>
            
            <input type="text" id="sBarcode" placeholder="Staff Barcode ID">
            <input type="text" id="sName" placeholder="Staff Name">
            <button onclick="saveItem('staff')">Register Staff Card</button>
        </div>
    </div>

    <script>
        // --- YOUR FIREBASE CONFIG ---
        const firebaseConfig = {
            apiKey: "AIzaSyAXtjM56OQso8g3RauOkT3h1ommplCelyE",
            authDomain: "checkout-c52ab.firebaseapp.com",
            projectId: "checkout-c52ab",
            storageBucket: "checkout-c52ab.firebasestorage.app",
            messagingSenderId: "486554411560",
            appId: "1:486554411560:web:9d24b172a86cfe1b2c0b1d"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // --- SCANNER LOGIC ---
        let html5QrcodeScanner = null;
        let activeTarget = 'p'; // 'p' for product, 's' for staff

        function toggleScanner(target) {
            activeTarget = target;
            const readerDiv = document.getElementById('reader');
            
            if (readerDiv.style.display === 'block') {
                readerDiv.style.display = 'none';
                if(html5QrcodeScanner) html5QrcodeScanner.clear();
            } else {
                readerDiv.style.display = 'block';
                html5QrcodeScanner = new Html5QrcodeScanner("reader", { fps: 10, qrbox: 250 });
                html5QrcodeScanner.render(onScanSuccess);
            }
        }

        function onScanSuccess(decodedText) {
            if (activeTarget === 'p') {
                document.getElementById('pBarcode').value = decodedText;
                document.getElementById('pBarcode').style.borderColor = "#27ae60";
            } else {
                document.getElementById('sBarcode').value = decodedText;
                document.getElementById('sBarcode').style.borderColor = "#27ae60";
            }
            // Flash success feedback
            if(navigator.vibrate) navigator.vibrate(50);
        }

        // --- CLOUD SAVE LOGIC ---
        async function saveItem(collection) {
            let id, data;
            
            if (collection === 'inventory') {
                id = document.getElementById('pBarcode').value;
                data = {
                    id: id,
                    name: document.getElementById('pName').value,
                    price: parseFloat(document.getElementById('pPrice').value)
                };
            } else {
                id = document.getElementById('sBarcode').value;
                data = { name: document.getElementById('sName').value };
            }

            if (!id || !data.name) return alert("Please fill in all fields!");

            await db.collection(collection).doc(id).set(data);
            alert("Successfully saved to Cloud!");
            
            // Clear inputs
            document.querySelectorAll('input').forEach(i => { i.value = ""; i.style.borderColor = "#ccc"; });
        }
    </script>
</body>
</html>
